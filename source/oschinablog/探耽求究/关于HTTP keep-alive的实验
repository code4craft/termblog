<h2>关于HTTP keep-alive的实验</h2><div class="BlogContent">
 <h1><span style="font-size:14px;line-height:1.6em;">&nbsp; &nbsp;前面一篇文章提到，HTTP1.1中持久连接已经是默认配置，除非设置Connection为close，否则默认都会进行持久连接。但是我们知道事实标准跟教科书还是可能会有一定差距的，所以不妨自己尝试一下。</span></h1> 
 <div class="rich-content"> 
  <p>&nbsp;&nbsp;&nbsp;我们知道，TCP建立连接时会进行三次握手，而握手是以一方发送一个SYN为开始的。下载抓包工具Wireshark之后，进行抓包调试。在Java里实现了一段模拟请求的代码：</p> 
  <div> 
   <div class="syntaxhighlighter java"> 
    <table border="0" cellpadding="0" cellspacing="0"> 
     <tbody> 
      <tr> 
       <td> 
        <div class="line number1 index0 alt2">
          1 
        </div> 
        <div class="line number2 index1 alt1">
          2 
        </div> 
        <div class="line number3 index2 alt2">
          3 
        </div> 
        <div class="line number4 index3 alt1">
          4 
        </div> 
        <div class="line number5 index4 alt2">
          5 
        </div> 
        <div class="line number6 index5 alt1">
          6 
        </div> 
        <div class="line number7 index6 alt2">
          7 
        </div> 
        <div class="line number8 index7 alt1">
          8 
        </div> 
        <div class="line number9 index8 alt2">
          9 
        </div> 
        <div class="line number10 index9 alt1">
          10 
        </div> 
        <div class="line number11 index10 alt2">
          11 
        </div> 
        <div class="line number12 index11 alt1">
          12 
        </div> 
        <div class="line number13 index12 alt2">
          13 
        </div> 
        <div class="line number14 index13 alt1">
          14 
        </div> 
        <div class="line number15 index14 alt2">
          15 
        </div> 
        <div class="line number16 index15 alt1">
          16 
        </div> 
        <div class="line number17 index16 alt2">
          17 
        </div> 
        <div class="line number18 index17 alt1">
          18 
        </div> 
        <div class="line number19 index18 alt2">
          19 
        </div> 
        <div class="line number20 index19 alt1">
          20 
        </div> 
        <div class="line number21 index20 alt2">
          21 
        </div> 
        <div class="line number22 index21 alt1">
          22 
        </div> 
        <div class="line number23 index22 alt2">
          23 
        </div> 
        <div class="line number24 index23 alt1">
          24 
        </div> 
        <div class="line number25 index24 alt2">
          25 
        </div> 
        <div class="line number26 index25 alt1">
          26 
        </div> 
        <div class="line number27 index26 alt2">
          27 
        </div> 
        <div class="line number28 index27 alt1">
          28 
        </div> 
        <div class="line number29 index28 alt2">
          29 
        </div> 
        <div class="line number30 index29 alt1">
          30 
        </div> 
        <div class="line number31 index30 alt2">
          31 
        </div> 
        <div class="line number32 index31 alt1">
          32 
        </div> 
        <div class="line number33 index32 alt2">
          33 
        </div> 
        <div class="line number34 index33 alt1">
          34 
        </div> 
        <div class="line number35 index34 alt2">
          35 
        </div> 
        <div class="line number36 index35 alt1">
          36 
        </div> 
        <div class="line number37 index36 alt2">
          37 
        </div> 
        <div class="line number38 index37 alt1">
          38 
        </div> 
        <div class="line number39 index38 alt2">
          39 
        </div> 
        <div class="line number40 index39 alt1">
          40 
        </div> 
        <div class="line number41 index40 alt2">
          41 
        </div> 
        <div class="line number42 index41 alt1">
          42 
        </div> 
        <div class="line number43 index42 alt2">
          43 
        </div> 
        <div class="line number44 index43 alt1">
          44 
        </div> 
        <div class="line number45 index44 alt2">
          45 
        </div> 
        <div class="line number46 index45 alt1">
          46 
        </div> 
        <div class="line number47 index46 alt2">
          47 
        </div> 
        <div class="line number48 index47 alt1">
          48 
        </div> 
        <div class="line number49 index48 alt2">
          49 
        </div> 
        <div class="line number50 index49 alt1">
          50 
        </div> 
        <div class="line number51 index50 alt2">
          51 
        </div> 
        <div class="line number52 index51 alt1">
          52 
        </div> 
        <div class="line number53 index52 alt2">
          53 
        </div> </td> 
       <td> 
        <div class="container"> 
         <div class="line number1 index0 alt2"> 
          <code>package</code> 
          <code>test;</code> 
         </div> 
         <div class="line number2 index1 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp; 
         </div> 
         <div class="line number3 index2 alt2"> 
          <code>import</code> 
          <code>java.io.IOException;</code> 
         </div> 
         <div class="line number4 index3 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp; 
         </div> 
         <div class="line number5 index4 alt2"> 
          <code>import</code> 
          <code>org.apache.commons.httpclient.HttpClient;</code> 
         </div> 
         <div class="line number6 index5 alt1"> 
          <code>import</code> 
          <code>org.apache.commons.httpclient.HttpException;</code> 
         </div> 
         <div class="line number7 index6 alt2"> 
          <code>import</code> 
          <code>org.apache.commons.httpclient.SimpleHttpConnectionManager;</code> 
         </div> 
         <div class="line number8 index7 alt1"> 
          <code>import</code> 
          <code>org.apache.commons.httpclient.methods.GetMethod;</code> 
         </div> 
         <div class="line number9 index8 alt2"> 
          <code>import</code> 
          <code>org.junit.Test;</code> 
         </div> 
         <div class="line number10 index9 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp; 
         </div> 
         <div class="line number11 index10 alt2"> 
          <code>/**</code> 
         </div> 
         <div class="line number12 index11 alt1"> 
          <code>&nbsp;</code> 
          <code>* TODO Comment of TestHttpClient</code> 
         </div> 
         <div class="line number13 index12 alt2"> 
          <code>&nbsp;</code> 
          <code>* </code> 
         </div> 
         <div class="line number14 index13 alt1"> 
          <code>&nbsp;</code> 
          <code>* <a href="http://my.oschina.net/arthor" target="_blank" rel="nofollow">@author</a> yihua.huang</code> 
         </div> 
         <div class="line number15 index14 alt2"> 
          <code>&nbsp;</code> 
          <code>* </code> 
         </div> 
         <div class="line number16 index15 alt1"> 
          <code>&nbsp;</code> 
          <code>*/</code> 
         </div> 
         <div class="line number17 index16 alt2"> 
          <code>public</code> 
          <code>class</code> 
          <code>TestHttpClient {</code> 
         </div> 
         <div class="line number18 index17 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp; 
         </div> 
         <div class="line number19 index18 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code><a href="http://my.oschina.net/saff" target="_blank" rel="nofollow">@Test</a> </code> 
         </div> 
         <div class="line number20 index19 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>public</code> 
          <code>void</code> 
          <code>testHeader() {</code> 
         </div> 
         <div class="line number21 index20 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>HttpClient httpClient = </code> 
          <code>new</code> 
          <code>HttpClient(</code> 
          <code>new</code> 
          <code>SimpleHttpConnectionManager(</code> 
          <code>true</code> 
          <code>));</code> 
         </div> 
         <div class="line number22 index21 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>httpClient.getHttpConnectionManager().getParams().setSoTimeout(</code> 
          <code>5000</code> 
          <code>);</code> 
         </div> 
         <div class="line number23 index22 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>httpClient.getHttpConnectionManager().getParams().setConnectionTimeout(</code> 
          <code>5000</code> 
          <code>);</code> 
         </div> 
         <div class="line number24 index23 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>GetMethod get = </code> 
          <code>new</code> 
          <code>GetMethod(</code> 
          <code>&quot;<a href="http://www.dianping.com/" rel="nofollow">http://www.dianping.com</a>&quot;</code> 
          <code>);</code> 
         </div> 
         <div class="line number25 index24 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>try</code> 
          <code>{</code> 
         </div> 
         <div class="line number26 index25 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>httpClient.executeMethod(get);</code> 
         </div> 
         <div class="line number27 index26 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>} </code> 
          <code>catch</code> 
          <code>(HttpException e) {</code> 
         </div> 
         <div class="line number28 index27 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>// TODO Auto-generated catch block</code> 
         </div> 
         <div class="line number29 index28 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>e.printStackTrace();</code> 
         </div> 
         <div class="line number30 index29 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>} </code> 
          <code>catch</code> 
          <code>(IOException e) {</code> 
         </div> 
         <div class="line number31 index30 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>// TODO Auto-generated catch block</code> 
         </div> 
         <div class="line number32 index31 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>e.printStackTrace();</code> 
         </div> 
         <div class="line number33 index32 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>}</code> 
         </div> 
         <div class="line number34 index33 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>try</code> 
          <code>{</code> 
         </div> 
         <div class="line number35 index34 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>Thread.sleep(</code> 
          <code>10000</code> 
          <code>);</code> 
         </div> 
         <div class="line number36 index35 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>} </code> 
          <code>catch</code> 
          <code>(InterruptedException e1) {</code> 
         </div> 
         <div class="line number37 index36 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>// TODO Auto-generated catch block</code> 
         </div> 
         <div class="line number38 index37 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>e1.printStackTrace();</code> 
         </div> 
         <div class="line number39 index38 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>}</code> 
         </div> 
         <div class="line number40 index39 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>get = </code> 
          <code>new</code> 
          <code>GetMethod(</code> 
          <code>&quot;<a href="http://www.dianping.com/" rel="nofollow">http://www.dianping.com</a>&quot;</code> 
          <code>);</code> 
         </div> 
         <div class="line number41 index40 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>get.setRequestHeader(</code> 
          <code>&quot;Connection&quot;</code> 
          <code>, </code> 
          <code>&quot;keep-alive&quot;</code> 
          <code>);</code> 
         </div> 
         <div class="line number42 index41 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>try</code> 
          <code>{</code> 
         </div> 
         <div class="line number43 index42 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>httpClient.executeMethod(get);</code> 
         </div> 
         <div class="line number44 index43 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>} </code> 
          <code>catch</code> 
          <code>(HttpException e) {</code> 
         </div> 
         <div class="line number45 index44 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>// TODO Auto-generated catch block</code> 
         </div> 
         <div class="line number46 index45 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>e.printStackTrace();</code> 
         </div> 
         <div class="line number47 index46 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>} </code> 
          <code>catch</code> 
          <code>(IOException e) {</code> 
         </div> 
         <div class="line number48 index47 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>// TODO Auto-generated catch block</code> 
         </div> 
         <div class="line number49 index48 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>e.printStackTrace();</code> 
         </div> 
         <div class="line number50 index49 alt1"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>}</code> 
         </div> 
         <div class="line number51 index50 alt2"> 
          <code>&nbsp;&nbsp;&nbsp;&nbsp;</code> 
          <code>}</code> 
         </div> 
         <div class="line number52 index51 alt1"> 
          <code>&nbsp;&nbsp;&nb